<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9VF4Q6SGC"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-E9VF4Q6SGC');
	</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Your cart page for SHAHICHAI.PK - Premium Quality Tea in Pakistan.">
    <meta name="author" content="SHAHICHAI.PK">
    <title>Your Cart | Shahi Chai - Premium Quality Tea in Pakistan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
	<header>
		<nav class="navbar navbar-expand-lg navbar-dark">
			<div class="container">
				<div>
					<a class="navbar-brand" href="index.html"></a>
				</div>
				<div>
					<a href="index.html"><img src="logo.png" alt="Shahi Chai Logo" class="logo"></a>
				</div>
				<div class="navbar">
					<div class="mitem"><a class="nav-link" href="index.html">Home</a></div>
					<div class="mitem cart-icon">
							<a class="nav-link" href="cart.html" aria-label="View Cart">
								<i class="bi bi-cart"></i> Cart
								<span class="cart-count" id="cart-count">0</span>
							</a>
					</div>
				</div>
			</div>
		</nav>
	</header>	
    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Shahi Chai - Premium Quality Tea in Pakistan</h1>
            <p>Indulge in the finest black tea, crafted for royalty</p>
            <a target="_blank" onclick="sendWhatsAppMessage(event)" class="cta-btn">WhatsApp</a>
        </div>
    </section>
    <!-- Cart Section -->
    <section class="">
        <div class="container">
            <h2 class="text-center" style="color:#000;">Your Cart</h2>
            <div id="cart-items">
                <!-- Cart items will be displayed here -->
            </div>
            <div class="text-center total-prices">
				<h4 id="empty-cart-message" class="center-align" style="display: none;">Your cart is empty!</h4>
				<h4 id="thank-you-cart-message" class="center-align" style="display: none;">Thank you for your order!</h4>
				<a target="_blank" href="https://shahichai.pk" class="center-align btn btn-yellow" id="continue-shopping-button" style="display: none;">Continue Shopping</a>
				<div id="total-price" class="total-price mt-3" style="font-weight: bold;"></div>
				<div id="dc-price" class="total-price mt-3" style="display: none;font-weight: bold;"> Delivery Charges: PKR 200</div>
				<div id="grand-total-price" class="total-price mt-3" style="font-weight: bold;"></div>
				<button class="btn btn-yellow checkout-btn" id="checkout-button" onclick="toggleCheckout()">Checkout</button>
			</div>
            <div class="checkout-form" id="checkout-form">
                <h4 class="mt-4">Checkout</h4>
                <form id="form" onsubmit="handleCheckout(event)">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" required>
						<span id="nameError" class="error"></span>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phone" required>
						<span id="phoneError" class="error"></span>
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <textarea class="form-control" id="address" rows="3" required></textarea>
						<span id="addressError" class="error"></span>
                    </div>
					<div class="mb-3">
						<label for="paymentmethod" class="form-check-label">Payment Method</label></br>
						<input type="radio" class="form-check-input" id="paymentmethod" checked>
						Cash On Delivery
						<span id="paymentmethodError" class="error"></span>
					</div>
                    <!-- Terms and Conditions Checkbox -->
					<div class="mb-3">
						<label class="form-check-label">
							<input type="checkbox" class="form-check-input" id="agreeTerms" required>
							I agree to the <a href="terms-and-conditions.html" target="_blank">Terms and Conditions</a>
						</label>
						<span id="termsError" class="error"></span>
					</div>

					<!-- Place Order Button (disabled by default) -->
					<button type="submit" class="btn btn-yellow" id="placeOrderButton" disabled>Place Order</button>
				</form>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer>
        <div class="container">
            <p>&copy; 2024 shahichai.pk | All Rights Reserved.</p>
            <p>Follow us on: <a target="_blank" href="https://www.facebook.com/shahichai.pk" style="text-decoration-line: none;color: white;">Facebook</a> | <a target="_blank" href="https://www.instagram.com/shahi.chai" style="text-decoration-line: none;color: white;">Instagram</a></p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
		let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
        let cartCount = localStorage.getItem('cartCount') || 0;
		// Add event listener for the checkbox
		document.getElementById('agreeTerms').addEventListener('change', function() {
			const placeOrderButton = document.getElementById('placeOrderButton');
			placeOrderButton.disabled = !this.checked; // Enable/Disable button based on checkbox
		});

		// Ensure the button is enabled if the checkbox is checked when the page loads
		window.onload = function() {
			const checkbox = document.getElementById('agreeTerms');
			const placeOrderButton = document.getElementById('placeOrderButton');
			placeOrderButton.disabled = !checkbox.checked; // Set button state on page load
		}

		// Additional validation to allow space in phone number
		document.getElementById('phone').addEventListener('input', function() {
			const phoneInput = this;
			phoneInput.value = phoneInput.value.replace(/[^0-9\s+]/g, ''); // Allow only numbers, spaces, and the plus sign
		});

        document.getElementById('cart-count').innerText = cartCount;
		function openNav() {
            document.getElementById("myNav").style.width = "100%";
        }
		function sendWhatsAppMessage(event) {
			event.preventDefault();
            // The WhatsApp number in international format (without '+' or '00', e.g. 923001234567 for Pakistan)
            //var phoneNumber = "+923137613439"; 
            // Message to be sent
            // WhatsApp URL
            //var url = "https://wa.me/" + phoneNumber + "?text=" + encodeURIComponent(message);
			//var url = "https://api.whatsapp.com/send/?phone=" + encodeURIComponent(phoneNumber) + "&text=" + encodeURIComponent(message) + "&type=phone_number&app_absent=0";
            // Open WhatsApp URL in a new tab
            // Open WhatsApp URL in a new tab
            //window.open(url, '_blank');
            let message = `Salam, I want to know more about Shahi Chai.`; 
			const whatsappNumber = "+923137613439";
			const whatsappLink = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
			window.open(whatsappLink, '_blank');
        }
        function closeNav() {
            document.getElementById("myNav").style.width = "0%";
        }		
        function loadCart() {
            const cartCount = localStorage.getItem('cartCount') || 0;
			document.getElementById('cart-count').innerText = cartCount;
			const cartItemsDiv = document.getElementById('cart-items');
			const emptyCartMessage = document.getElementById('empty-cart-message');
			const continueShoppingButton = document.getElementById('continue-shopping-button');
			const checkoutButton = document.getElementById('checkout-button');
			const dcPriceDiv = document.getElementById('dc-price');
			const totalPriceDiv = document.getElementById('total-price');
			const grandTotalPriceDiv = document.getElementById('grand-total-price');
			const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

			if (cartCount == 0) {
				emptyCartMessage.style.display = 'block';
				continueShoppingButton.style.display = 'block';
				checkoutButton.style.display = 'none';
				dcPriceDiv.style.display = 'none';
				totalPriceDiv.innerText = '';
				grandTotalPriceDiv.innerText = '';
				cartItemsDiv.innerHTML = '';
				document.getElementById('checkout-form').style.display = 'none';
			} else {
				emptyCartMessage.style.display = 'none';
				checkoutButton.style.display = 'block';
				dcPriceDiv.style.display = 'block';
				cartItemsDiv.innerHTML = '';
				let totalPrice = 0;
				for (const itemName in cartItems) {
					if (cartItems.hasOwnProperty(itemName)) {
						const item = cartItems[itemName];

						// Ensure price is a number (in case it's a string in your data)
						item.price = Number(item.price);

						// Set default quantity to 1 if itâ€™s not already set
						item.quantity = item.quantity || 1;

						// Calculate total price for the item
						const itemTotalPrice = item.price * item.quantity;
						totalPrice += itemTotalPrice;  // Update total price for the cart

						const itemDiv = document.createElement('div');
						itemDiv.classList.add('cart-item');

						// Check if the image exists to prevent errors if no image is set
						const itemImage = item.image ? `<img src="${item.image}" alt="${itemName}">` : '';

						itemDiv.innerHTML = `
							${itemImage}
							<div class="flex-grow-1">
								<strong>${itemName}</strong><br>
								Unit Price: PKR ${item.price} 
								<span class="remove-item" onclick="removeFromCart('${itemName}')">X</span>
							</div>
							<div>
								<input type="number" value="${item.quantity}" min="1" onchange="updateQuantity('${itemName}', this.value)" style="width: 60px;">
								<br>Total: PKR ${itemTotalPrice}
							</div>`;

						cartItemsDiv.appendChild(itemDiv);
					}
				}
				totalPriceDiv.innerText = `Total: PKR ${totalPrice}`;
				grandTotalPriceDiv.innerText = `Grand Total: PKR ${totalPrice + 200}`;
			}
        }

        function updateQuantity(index, quantity) {
            //let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
            cartItems[index].quantity = parseInt(quantity);
            localStorage.setItem('cartItems', JSON.stringify(cartItems)); // Update localStorage
            localStorage.setItem('cartCount', cartItems.length); // Update cart count
            loadCart(); // Reload the cart to recalculate total
        }

        function removeFromCart001(index) {
            //let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
            cartItems.splice(index, 1); // Remove the item from the array
            localStorage.setItem('cartItems', JSON.stringify(cartItems)); // Update localStorage
            localStorage.setItem('cartCount', cartItems.length); // Update cart count
            loadCart(); // Reload the cart
        }
		function removeFromCart (name) {
			const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
			// Check if the item exists in the cart
			if (cartItems[name]) {
				// Delete the item from cartItems object by its name
				delete cartItems[name];

				// Update localStorage
				localStorage.setItem('cartItems', JSON.stringify(cartItems)); // Update cartItems in localStorage
				localStorage.setItem('cartCount', Object.keys(cartItems).length); // Update cart count based on number of items

				// Reload the cart to recalculate total and update the display
				loadCart();
			} else {
				console.error("Item not found in cart:", name);
			}
		}
        function clearCart() {
			debugger;
            localStorage.removeItem('cartCount'); // Clear cart in localStorage
            localStorage.removeItem('cartItems'); // Clear cart items in localStorage
            document.getElementById('cart-items').innerHTML = ''; // Clear displayed cart items
            document.getElementById('empty-cart-message').style.display = 'block'; // Show empty message
            document.getElementById('cart-count').innerText = '0'; // Reset cart count in navbar
            document.getElementById('total-price').innerText = ''; // Clear total price
            document.getElementById('grand-total-price').innerText = ''; // Clear total price
			
			localStorage.removeItem('cartCount'); // Clear cart in localStorage
			localStorage.removeItem('cartItems'); // Clear cart items in localStorage
			document.getElementById('cart-items').innerHTML = ''; // Clear displayed cart items
			document.getElementById('empty-cart-message').style.display = 'none'; // Show empty message
			document.getElementById('checkout-form').style.display = 'none'; // Show empty message
			document.getElementById('cart-count').innerText = '0'; // Reset cart count in navbar
			document.getElementById('total-price').innerText = ''; // Clear total price
			document.getElementById('grand-total-price').innerText = ''; // Clear total price
			document.getElementById('checkout-button').style.display = 'none';
			document.getElementById('thank-you-cart-message').style.display = 'block'; // Clear total price
			document.getElementById('continue-shopping-button').style.display = 'block'; // Clear total price
			document.getElementById('dc-price').innerText = ''; // Clear total price

        }

        function toggleCheckout() {
            const checkoutForm = document.getElementById('checkout-form');
            checkoutForm.style.display = checkoutForm.style.display === 'block' ? 'none' : 'block';
        }

        function handleCheckout(event) {
			event.preventDefault();
			document.getElementById('nameError').textContent = '';
			document.getElementById('phoneError').textContent = '';
			document.getElementById('addressError').textContent = '';
			const name = document.getElementById('name').value.trim();
			const phone = document.getElementById('phone').value.trim();
			const address = document.getElementById('address').value.trim();
			let valid = true;
			const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
			const nameRegex = /^[A-Za-z\s]+$/;
			if (!nameRegex.test(name)) {
				document.getElementById('nameError').textContent = 'Please enter a valid name (alphabets only).';
				valid = false;
			}
			const phoneRegex = /^\+?\d{9,13}$/;
			if (!phoneRegex.test(phone)) {
				document.getElementById('phoneError').textContent = 'Please enter a valid phone number.';
				valid = false;
			}
			const addressRegex = /^[A-Za-z0-9\s]+$/;
			if (!addressRegex.test(address)) {
				document.getElementById('addressError').textContent = 'Please enter a valid address (alphanumeric).';
				valid = false;
			}
			if (valid) {
				let message = `Order Details:\nName: ${name}\nPhone: ${phone}\nAddress: ${address}\n\nProducts:\n`;
				let items = '';
				for (const itemName in cartItems) {
					if (cartItems.hasOwnProperty(itemName)) {
						const item = cartItems[itemName];
						items += `${itemName} - Quantity: ${item.quantity} - Price: PKR ${item.price * item.quantity}\n`;
					}
				}
				message += items;
				const total = Object.values(cartItems).reduce((sum, item) => sum + (item.price * item.quantity), 0);
				message += `\nTotal: PKR ${total}`;
				const orderData = {
					name: name,
					phone: phone,
					address: address,
					items: items,
					total: total
				};
				fetch('http://localhost/mamo.pk/mamo-api/save_order.php', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(orderData)
				})
				.then(response => response.json())
				.then(data => {
					if (data.message === 'Order placed successfully') {
						//const whatsappLink = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
						//window.open(whatsappLink, '_blank');
						clearCart();
						const checkoutForm = document.getElementById('checkout-form');
						checkoutForm.style.display = 'none';
						alert('Order placed successfully! Thank you for your purchase. :)');
					} else {
						alert('Error placing order: ' + data.message);
					}
				})
				.catch(error => {
					console.error('Error:', error);
					alert('An error occurred while placing the order.');
				});
			}
        }
        window.onload = loadCart; // Load cart on page load
    </script>
</body>
</html>
